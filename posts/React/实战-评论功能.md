# 实战-评论功能 #

**组件划分**

`React.js` 中一切都是组件，用 `React.js` 构建的功能其实也就是由各种组件组合而成。所以拿到一个需求以后，我们要做的第一件事情就是理解需求、分析需求、划分这个需求由哪些组件构成。

组件的划分没有特别明确的标准。划分组件的目的性是为了代码可复用性、可维护性。只要某个部分有可能复用到别的地方，你都可以把它抽离出来当成一个组件；或者把某一部分抽离出来对代码的组织和管理会带来帮助，你也可以毫不犹豫地把它抽离出来。

![](https://i.imgur.com/BpfAmwi.png)

- `CommentApp`：评论功能的整体用一个叫 `CommentApp` 的组件包含起来。`CommentApp` 包含上部和下部两部分。
- `CommentInput`：上面部分是负责用户输入可操作的输入区域，包括输入评论的用户名、评论内容和发布按钮，这一部分功能划分到一个单独的组件 `CommentInput` 中。
- `CommentList`：下面部分是评论列表，用一个叫 `CommentList` 的组件负责列表的展示。
- `Comment`：每个评论列表项由独立的组件 `Comment` 负责显示，这个组件被 `CommentList` 所使用。

**组件实现**

在写代码之前，我们先用 `create-react-app` 构建一个新的工程目录。所有的评论功能在这个工程内完成：

    create-react-app comment-app

然后在工程目录下的 `src/` 目录下新建四个文件，每个文件对应的是上述的四个组件。

    src/
      CommentApp.js
      CommentInput.js
      CommentList.js
      Comment.js

**添加样式**

**处理用户输入**

在 `React.js` 当中必须要用 `setState` 才能更新组件的内容，所以我们需要做的就是：监听输入框的 `onChange` 事件，然后获取到用户输入的内容，再通过 `setState` 的方式更新 `state` 中的 `username`，这样 `input` 的内容才会更新。

在这个方法中，我们通过 `event.target.value` 获取 `<input />` 中用户输入的内容，然后通过 `setState` 把它设置到 `state.username` 当中，这时候组件的内容就会更新，`input` 的 `value` 值就会得到更新并显示到输入框内。这时候输入已经没有问题了。

类似于 `<input />`、`<select />`、`<textarea>` 这些元素的 `value` 值被 `React.js` 所控制、渲染的组件，在 `React.js` 当中被称为受控组件。对于用户可输入的控件，一般都可以让它们成为受控组件，这是 `React.js` 所推崇的做法。

**向父组件传递数据**

当用户在 `CommentInput` 里面输入完内容以后，点击发布，内容其实是需要显示到 `CommentList` 组件当中的。但这两个组件明显是单独的、分离的组件。

`CommentApp` 组件将 `CommentInput` 和 `CommentList` 组合起来，它是它们俩的父组件，可以充当桥接两个子组件的桥梁。所以当用户点击发布按钮的时候，我们就将 `CommentInput` 的 `state` 当中最新的评论数据传递给父组件 `CommentApp` ，然后让父组件把这个数据传递给 `CommentList` 进行渲染。

`CommentInput` 如何向 `CommentApp` 传递的数据？父组件 `CommentApp` 只需要通过 `props` 给子组件 `CommentInput` 传入一个回调函数。当用户点击发布按钮的时候，`CommentInput` 调用 `props` 中的回调函数并且将 `state` 传入该函数即可。

`handleSubmit` 方法会判断 `props` 中是否传入了 `onSubmit` 属性。有的话就调用该函数，并且把用户输入的用户名和评论数据传入该函数。然后再通过 `setState` 清空用户输入的评论内容。

我们在 `CommentApp` 的 `state` 中初始化一个数组，来保存所有的评论数据，并且通过 `props` 把它传递给 `CommentList`。

**总结**

1. 实现功能之前先理解、分析需求，划分组件。并且掌握划分组件的基本原则——可复用性、可维护性。
2. 受控组件的概念，`React.js` 中的 `<input />` 、`<textarea />`、`<select />` 等元素的 `value` 值如果是受到 `React.js` 的控制，那么就是受控组件。
3. 组件之间使用 `props` 通过父元素传递数据的技巧。